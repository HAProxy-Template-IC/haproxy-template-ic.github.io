{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Helm Chart Installation","text":"<p>The Helm chart is the recommended way to deploy HAProxy Template IC. It includes:</p> <ul> <li>Pre-built template libraries for Kubernetes Ingress and Gateway API</li> <li>HAProxy annotation support compatible with haproxy.org annotations</li> <li>Sensible defaults for production deployments</li> <li>High availability with leader election enabled by default</li> </ul> <p>For users who need full control over templates, see the Templating Guide.</p>"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes 1.19+</li> <li>Helm 3.0+</li> <li>HAProxy pods with Dataplane API sidecars (deployed separately)</li> <li>HAProxy 3.0 or newer (template libraries require HAProxy 3.0+ for SSL/TLS features)</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#add-the-helm-repository","title":"Add the Helm Repository","text":"<pre><code>helm repo add haproxy-template-ic https://haproxy-template-ic.github.io/charts\nhelm repo update\n</code></pre>"},{"location":"#install-the-chart","title":"Install the Chart","text":"<pre><code>helm install my-controller haproxy-template-ic/haproxy-template-ic\n</code></pre>"},{"location":"#with-custom-values","title":"With Custom Values","text":"<pre><code>helm install my-controller haproxy-template-ic/haproxy-template-ic \\\n  --set image.tag=v0.1.0 \\\n  --set replicaCount=2\n</code></pre>"},{"location":"#with-values-file","title":"With Values File","text":"<pre><code>helm install my-controller haproxy-template-ic/haproxy-template-ic \\\n  -f my-values.yaml\n</code></pre>"},{"location":"#key-configuration-options","title":"Key Configuration Options","text":"Parameter Description Default <code>replicaCount</code> Number of controller replicas (2+ recommended for HA) <code>2</code> <code>image.repository</code> Controller image repository <code>ghcr.io/haproxy-template-ic/haproxy-template-ingress-controller</code> <code>image.tag</code> Controller image tag Chart appVersion <code>controller.templateLibraries.ingress.enabled</code> Enable Ingress resource support <code>true</code> <code>controller.templateLibraries.gateway.enabled</code> Enable Gateway API support <code>false</code> <code>ingressClass.enabled</code> Create IngressClass resource <code>true</code> <code>ingressClass.name</code> IngressClass name <code>haproxy</code> <code>gatewayClass.enabled</code> Create GatewayClass resource <code>true</code> <code>gatewayClass.name</code> GatewayClass name <code>haproxy</code> <code>credentials.dataplane.username</code> Dataplane API username <code>admin</code> <code>credentials.dataplane.password</code> Dataplane API password <code>adminpass</code>"},{"location":"#template-libraries","title":"Template Libraries","text":"<p>The chart includes pre-built template libraries that can be enabled/disabled:</p> Library Description Default <code>ingress</code> Kubernetes Ingress support Enabled <code>gateway</code> Gateway API (HTTPRoute, GRPCRoute) Disabled <code>haproxytech</code> HAProxy annotation compatibility Enabled"},{"location":"#enable-gateway-api","title":"Enable Gateway API","text":"<pre><code>controller:\n  templateLibraries:\n    gateway:\n      enabled: true\n</code></pre> <p>See Gateway API Support for details on supported features.</p>"},{"location":"#haproxy-pod-selection","title":"HAProxy Pod Selection","text":"<p>The controller watches HAProxy pods based on label selectors:</p> <pre><code>controller:\n  config:\n    pod_selector:\n      match_labels:\n        app: haproxy\n        component: loadbalancer\n</code></pre> <p>Customize this to match your HAProxy deployment's labels.</p>"},{"location":"#further-reading","title":"Further Reading","text":"<ul> <li>Gateway API Support - HTTPRoute and GRPCRoute configuration</li> <li>HAProxy Annotations - Compatible annotations reference</li> <li>Controller Documentation - Architecture and advanced configuration</li> </ul>"},{"location":"annotations/","title":"HAProxy Tech Annotations Support","text":"<p>The HAProxy Template Ingress Controller chart provides support for HAProxy Tech Ingress annotations through the <code>haproxytech.yaml</code> template library. This document describes which annotations from the HAProxy Ingress Controller are currently supported.</p>"},{"location":"annotations/#overview","title":"Overview","text":"<p>Annotation support is implemented as a template library that plugs into the controller's resource-agnostic architecture. The controller itself doesn't have built-in annotation handling - annotation support is added by the chart through template libraries.</p> <p>Enable HAProxy Tech annotation support:</p> <pre><code># values.yaml\ncontroller:\n  templateLibraries:\n    haproxytech:\n      enabled: true\n</code></pre> <p>Important notes:</p> <ul> <li>Annotations apply to Ingress resources only (not Services)</li> <li>Gateway API resources (HTTPRoute, GRPCRoute) use filters instead of annotations - see Gateway API Support</li> <li>All annotations use the <code>haproxy.org/</code> prefix</li> <li>Multiple ingresses can share the same annotation values (deduplication is handled automatically)</li> </ul>"},{"location":"annotations/#access-control-ip-filtering","title":"Access Control &amp; IP Filtering","text":""},{"location":"annotations/#haproxyorgallowlist","title":"haproxy.org/allowlist","text":"<p>Status: \u2705 Supported</p> <p>Description: Whitelist IP addresses or CIDR ranges that are allowed to access the ingress.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: protected-api\n  annotations:\n    haproxy.org/allowlist: \"192.168.1.0/24, 10.0.0.1\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Frontend ACL\nacl allowlist_192_168_1_0_24 src 192.168.1.0/24\nacl allowlist_10_0_0_1 src 10.0.0.1\nhttp-request deny if !allowlist_192_168_1_0_24 !allowlist_10_0_0_1\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: Can be combined with <code>denylist</code></p>"},{"location":"annotations/#haproxyorgdenylist","title":"haproxy.org/denylist","text":"<p>Status: \u2705 Supported</p> <p>Description: Blacklist IP addresses or CIDR ranges that are denied access to the ingress.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: public-api\n  annotations:\n    haproxy.org/denylist: \"203.0.113.0/24, 198.51.100.50\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Frontend ACL\nacl denylist_203_0_113_0_24 src 203.0.113.0/24\nacl denylist_198_51_100_50 src 198.51.100.50\nhttp-request deny if denylist_203_0_113_0_24 or denylist_198_51_100_50\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: Can be combined with <code>allowlist</code></p>"},{"location":"annotations/#haproxyorgwhitelist","title":"haproxy.org/whitelist","text":"<p>Status: \u274c Not Implemented (Deprecated)</p> <p>Description: Legacy name for <code>allowlist</code>. Prefer using <code>allowlist</code> instead.</p> <p>Note: Deprecated in favor of <code>allowlist</code>. Not recommended for new implementations.</p>"},{"location":"annotations/#haproxyorgblacklist","title":"haproxy.org/blacklist","text":"<p>Status: \u274c Not Implemented (Deprecated)</p> <p>Description: Legacy name for <code>denylist</code>. Prefer using <code>denylist</code> instead.</p> <p>Note: Deprecated in favor of <code>denylist</code>. Not recommended for new implementations.</p>"},{"location":"annotations/#cors-configuration","title":"CORS Configuration","text":""},{"location":"annotations/#haproxyorgcors-enable","title":"haproxy.org/cors-enable","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable CORS (Cross-Origin Resource Sharing) processing for the ingress.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: cors-api\n  annotations:\n    haproxy.org/cors-enable: \"true\"\n    haproxy.org/cors-allow-origin: \"*\"\n    haproxy.org/cors-allow-methods: \"GET, POST, PUT, DELETE\"\n    haproxy.org/cors-allow-headers: \"Content-Type, Authorization\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /api\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Capture Origin header\nhttp-request capture req.hdr(Origin) len 128\n\n# Set CORS headers\nhttp-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)]\nhttp-response set-header Access-Control-Allow-Methods \"GET, POST, PUT, DELETE\"\nhttp-response set-header Access-Control-Allow-Headers \"Content-Type, Authorization\"\n</code></pre> <p>Dependencies: All other <code>cors-*</code> annotations require <code>cors-enable: \"true\"</code></p>"},{"location":"annotations/#haproxyorgcors-allow-origin","title":"haproxy.org/cors-allow-origin","text":"<p>Status: \u2705 Supported</p> <p>Description: Specifies allowed origins for CORS requests. Supports wildcard (<code>*</code>), exact URL, or regex pattern.</p> <p>Usage:</p> <pre><code># Wildcard (allow all origins)\nhaproxy.org/cors-allow-origin: \"*\"\n\n# Exact match\nhaproxy.org/cors-allow-origin: \"https://example.com\"\n\n# Regex pattern\nhaproxy.org/cors-allow-origin: \"^https://(.+\\\\.)?(example\\\\.com)(:\\\\d{1,5})?$\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Wildcard\nhttp-response set-header Access-Control-Allow-Origin \"*\"\n\n# Exact or regex match\nhttp-response set-header Access-Control-Allow-Origin %[capture.req.hdr(0)] if { capture.req.hdr(0) -m reg ^https://(.+\\.)?(example\\.com)(:\\d{1,5})?$ }\n</code></pre> <p>Dependencies: Requires <code>cors-enable: \"true\"</code></p>"},{"location":"annotations/#haproxyorgcors-allow-methods","title":"haproxy.org/cors-allow-methods","text":"<p>Status: \u2705 Supported</p> <p>Description: Specifies allowed HTTP methods for CORS requests.</p> <p>Valid values: GET, POST, PUT, DELETE, HEAD, CONNECT, OPTIONS, TRACE, PATCH</p> <p>Usage:</p> <pre><code>haproxy.org/cors-allow-methods: \"GET, POST, PUT, DELETE, OPTIONS\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-response set-header Access-Control-Allow-Methods \"GET, POST, PUT, DELETE, OPTIONS\"\n</code></pre> <p>Dependencies: Requires <code>cors-enable: \"true\"</code></p>"},{"location":"annotations/#haproxyorgcors-allow-headers","title":"haproxy.org/cors-allow-headers","text":"<p>Status: \u2705 Supported</p> <p>Description: Specifies allowed request headers for CORS requests.</p> <p>Usage:</p> <pre><code>haproxy.org/cors-allow-headers: \"Content-Type, Authorization, X-Requested-With\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-response set-header Access-Control-Allow-Headers \"Content-Type, Authorization, X-Requested-With\"\n</code></pre> <p>Dependencies: Requires <code>cors-enable: \"true\"</code></p>"},{"location":"annotations/#haproxyorgcors-allow-credentials","title":"haproxy.org/cors-allow-credentials","text":"<p>Status: \u2705 Supported</p> <p>Description: Indicates whether credentials (cookies, authorization headers) can be included in CORS requests.</p> <p>Usage:</p> <pre><code>haproxy.org/cors-allow-credentials: \"true\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-response set-header Access-Control-Allow-Credentials \"true\"\n</code></pre> <p>Dependencies: Requires <code>cors-enable: \"true\"</code></p> <p>Note: When <code>cors-allow-credentials: \"true\"</code>, <code>cors-allow-origin</code> cannot be <code>*</code> (must be specific origin)</p>"},{"location":"annotations/#haproxyorgcors-max-age","title":"haproxy.org/cors-max-age","text":"<p>Status: \u2705 Supported</p> <p>Description: Specifies how long (in seconds) preflight request results can be cached.</p> <p>Usage:</p> <pre><code>haproxy.org/cors-max-age: \"3600\"  # 1 hour\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-response set-header Access-Control-Max-Age \"3600\"\n</code></pre> <p>Dependencies: Requires <code>cors-enable: \"true\"</code></p>"},{"location":"annotations/#rate-limiting","title":"Rate Limiting","text":""},{"location":"annotations/#haproxyorgrate-limit-requests","title":"haproxy.org/rate-limit-requests","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum number of requests allowed in the specified time period (per source IP).</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: rate-limited-api\n  annotations:\n    haproxy.org/rate-limit-requests: \"100\"\n    haproxy.org/rate-limit-period: \"1m\"\n    haproxy.org/rate-limit-size: \"100k\"\n    haproxy.org/rate-limit-status-code: \"429\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /api\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>backend api-backend\n    stick-table type ip size 100k expire 1m store http_req_rate(1m)\n    http-request track-sc0 src\n    http-request deny deny_status 429 if { sc_http_req_rate(0) gt 100 }\n</code></pre> <p>Dependencies: Other rate-limit annotations require this to be set</p> <p>Related annotations: <code>rate-limit-period</code>, <code>rate-limit-size</code>, <code>rate-limit-status-code</code></p>"},{"location":"annotations/#haproxyorgrate-limit-period","title":"haproxy.org/rate-limit-period","text":"<p>Status: \u2705 Supported</p> <p>Description: Time window for rate limiting. Supports duration format (e.g., <code>10s</code>, <code>1m</code>, <code>1h</code>).</p> <p>Default: <code>1s</code> (1 second)</p> <p>Usage:</p> <pre><code>haproxy.org/rate-limit-period: \"1m\"\n</code></pre> <p>Dependencies: Requires <code>rate-limit-requests</code> to be set</p>"},{"location":"annotations/#haproxyorgrate-limit-size","title":"haproxy.org/rate-limit-size","text":"<p>Status: \u2705 Supported</p> <p>Description: Size of the stick-table used to track client IPs. Supports suffixes <code>k</code> (thousands) or <code>M</code> (millions).</p> <p>Default: <code>100k</code> (100,000 entries)</p> <p>Usage:</p> <pre><code>haproxy.org/rate-limit-size: \"100k\"  # Track 100,000 IPs\nhaproxy.org/rate-limit-size: \"1000000\"  # Track 1 million IPs\n</code></pre> <p>Dependencies: Requires <code>rate-limit-requests</code> to be set</p>"},{"location":"annotations/#haproxyorgrate-limit-status-code","title":"haproxy.org/rate-limit-status-code","text":"<p>Status: \u2705 Supported</p> <p>Description: HTTP status code to return when rate limit is exceeded.</p> <p>Default: <code>403</code> (Forbidden)</p> <p>Common values: <code>403</code>, <code>429</code> (Too Many Requests), <code>503</code> (Service Unavailable)</p> <p>Usage:</p> <pre><code>haproxy.org/rate-limit-status-code: \"429\"\n</code></pre> <p>Dependencies: Requires <code>rate-limit-requests</code> to be set</p>"},{"location":"annotations/#requestresponse-header-manipulation","title":"Request/Response Header Manipulation","text":""},{"location":"annotations/#haproxyorgrequest-set-header","title":"haproxy.org/request-set-header","text":"<p>Status: \u2705 Supported</p> <p>Description: Set or modify request headers before forwarding to backend. Multiline format with each line containing <code>HeaderName HeaderValue</code>.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: header-example\n  annotations:\n    haproxy.org/request-set-header: |\n      X-Forwarded-Proto https\n      X-Custom-Header custom-value\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-request set-header X-Forwarded-Proto \"https\"\nhttp-request set-header X-Custom-Header \"custom-value\"\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>response-set-header</code>, <code>set-host</code></p>"},{"location":"annotations/#haproxyorgresponse-set-header","title":"haproxy.org/response-set-header","text":"<p>Status: \u2705 Supported</p> <p>Description: Set or modify response headers before returning to client. Multiline format with each line containing <code>HeaderName HeaderValue</code>.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: security-headers\n  annotations:\n    haproxy.org/response-set-header: |\n      Strict-Transport-Security \"max-age=31536000; includeSubDomains\"\n      X-Frame-Options DENY\n      X-Content-Type-Options nosniff\nspec:\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: web-service\n                port:\n                  number: 80\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-response set-header Strict-Transport-Security \"max-age=31536000; includeSubDomains\"\nhttp-response set-header X-Frame-Options \"DENY\"\nhttp-response set-header X-Content-Type-Options \"nosniff\"\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>request-set-header</code></p>"},{"location":"annotations/#haproxyorgset-host","title":"haproxy.org/set-host","text":"<p>Status: \u2705 Supported</p> <p>Description: Modify the Host header after backend selection. Different from <code>request-set-header Host</code> in timing.</p> <p>Usage:</p> <pre><code>haproxy.org/set-host: \"internal-api.example.svc.cluster.local\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-request set-header Host \"internal-api.example.svc.cluster.local\"\n</code></pre> <p>Dependencies: None</p> <p>Note: This happens after backend selection, while <code>request-set-header Host</code> happens before.</p>"},{"location":"annotations/#haproxyorgforwarded-for","title":"haproxy.org/forwarded-for","text":"<p>Status: \u2705 Supported</p> <p>Description: Add X-Forwarded-For header with client IP address.</p> <p>Default: <code>true</code></p> <p>Usage:</p> <pre><code>haproxy.org/forwarded-for: \"true\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>option forwardfor\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#path-manipulation","title":"Path Manipulation","text":""},{"location":"annotations/#haproxyorgpath-rewrite","title":"haproxy.org/path-rewrite","text":"<p>Status: \u2705 Supported</p> <p>Description: Rewrite request path using regex patterns before forwarding to backend. Supports two formats: single parameter (matches all paths) or two parameters (regex pattern and replacement).</p> <p>Usage:</p> <pre><code># Strip prefix: /api/v1/users -&gt; /users\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: path-rewrite-example\n  annotations:\n    haproxy.org/path-rewrite: |\n      ^/api/v1/(.*) /\\1\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /api/v1\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-request replace-path ^/api/v1/(.*) /\\1\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: Similar to Gateway API URLRewrite filter</p>"},{"location":"annotations/#request-redirect","title":"Request Redirect","text":""},{"location":"annotations/#haproxyorgrequest-redirect","title":"haproxy.org/request-redirect","text":"<p>Status: \u2705 Supported</p> <p>Description: Redirect requests to a different host/port. Supports formats: <code>example.com</code>, <code>example.com:8888</code>, <code>https://example.com</code>, <code>http://example.com</code>.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: redirect-example\n  annotations:\n    haproxy.org/request-redirect: \"https://new.example.com\"\n    haproxy.org/request-redirect-code: \"301\"\nspec:\n  rules:\n    - host: old.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: placeholder-service\n                port:\n                  number: 80\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-request redirect location https://new.example.com code 301\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>request-redirect-code</code></p>"},{"location":"annotations/#haproxyorgrequest-redirect-code","title":"haproxy.org/request-redirect-code","text":"<p>Status: \u2705 Supported</p> <p>Description: HTTP status code for redirect.</p> <p>Default: <code>302</code> (Found)</p> <p>Valid values: <code>301</code> (Moved Permanently), <code>302</code> (Found), <code>303</code> (See Other), <code>307</code> (Temporary Redirect), <code>308</code> (Permanent Redirect)</p> <p>Usage:</p> <pre><code>haproxy.org/request-redirect-code: \"301\"\n</code></pre> <p>Dependencies: Requires <code>request-redirect</code> to be set</p>"},{"location":"annotations/#ssltls-configuration","title":"SSL/TLS Configuration","text":""},{"location":"annotations/#haproxyorgssl-redirect","title":"haproxy.org/ssl-redirect","text":"<p>Status: \u2705 Supported</p> <p>Description: Force HTTPS redirect for HTTP requests. Automatically enabled when TLS secrets are present in the ingress.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ssl-redirect-example\n  annotations:\n    haproxy.org/ssl-redirect: \"true\"\n    haproxy.org/ssl-redirect-code: \"301\"\nspec:\n  tls:\n    - hosts:\n        - example.com\n      secretName: example-tls\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: web-service\n                port:\n                  number: 80\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-request redirect scheme https code 301 if !{ ssl_fc }\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>ssl-redirect-code</code>, <code>ssl-redirect-port</code></p>"},{"location":"annotations/#haproxyorgssl-redirect-code","title":"haproxy.org/ssl-redirect-code","text":"<p>Status: \u2705 Supported</p> <p>Description: HTTP status code for SSL redirect.</p> <p>Default: <code>302</code></p> <p>Valid values: <code>301</code>, <code>302</code>, <code>303</code>, <code>307</code>, <code>308</code></p> <p>Usage:</p> <pre><code>haproxy.org/ssl-redirect-code: \"301\"\n</code></pre> <p>Dependencies: Requires <code>ssl-redirect: \"true\"</code></p>"},{"location":"annotations/#haproxyorgssl-redirect-port","title":"haproxy.org/ssl-redirect-port","text":"<p>Status: \u2705 Supported</p> <p>Description: Target HTTPS port for SSL redirect.</p> <p>Default: <code>443</code></p> <p>Usage:</p> <pre><code>haproxy.org/ssl-redirect-port: \"8443\"\n</code></pre> <p>Dependencies: Requires <code>ssl-redirect: \"true\"</code></p>"},{"location":"annotations/#haproxyorgssl-passthrough","title":"haproxy.org/ssl-passthrough","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable TCP mode SSL passthrough (Layer 4) for specific ingresses while allowing SSL termination for others. Uses SNI-based routing with unix socket loopback to support mixed passthrough and termination traffic.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ssl-passthrough-example\n  annotations:\n    haproxy.org/ssl-passthrough: \"true\"\nspec:\n  tls:\n    - hosts:\n        - secure.example.com\n      secretName: example-tls\n  rules:\n    - host: secure.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: secure-service\n                port:\n                  number: 443\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># TCP frontend for SNI-based routing\nfrontend ssl-tcp\n    mode tcp\n    bind *:443\n    tcp-request inspect-delay 5s\n    tcp-request content accept if { req_ssl_hello_type 1 }\n    use_backend ssl-passthrough-default-ssl-passthrough-ingress if { req_ssl_sni -m str secure.example.com }\n    default_backend ssl-loopback\n\n# HTTPS frontend on unix socket (for SSL termination)\nfrontend ssl-https\n    mode http\n    bind unix@/etc/haproxy/ssl-frontend.sock mode 660 accept-proxy\n    # Standard HTTP routing logic applies here\n\n# SSL passthrough backend (TCP mode)\nbackend ssl-passthrough-default-ssl-passthrough-ingress\n    mode tcp\n    balance roundrobin\n    server SRV_1 10.0.1.30:8443 check\n\n# Loopback backend for SSL termination\nbackend ssl-loopback\n    mode tcp\n    server loopback unix@/etc/haproxy/ssl-frontend.sock send-proxy-v2\n</code></pre> <p>Implementation Notes:</p> <ul> <li>Uses unix socket loopback pattern to support mixed passthrough and termination</li> <li>TCP frontend extracts SNI without terminating SSL</li> <li>Passthrough traffic routes directly to backend pods</li> <li>Non-passthrough traffic routes to unix socket frontend for SSL termination</li> <li>PROXY protocol v2 preserves client IP information</li> </ul> <p>Dependencies: None</p> <p>Warning: For passthrough traffic, HTTP-level features (headers, path rewriting, etc.) are unavailable. Non-passthrough traffic on other hosts continues to support all HTTP features.</p>"},{"location":"annotations/#haproxyorgserver-ssl","title":"haproxy.org/server-ssl","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable SSL/TLS connection to backend servers.</p> <p>Usage:</p> <pre><code>haproxy.org/server-ssl: \"true\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8443 ssl verify none\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>server-proto</code>, <code>server-crt</code>, <code>server-ca</code></p>"},{"location":"annotations/#haproxyorgserver-proto","title":"haproxy.org/server-proto","text":"<p>Status: \u2705 Supported</p> <p>Description: Backend protocol (typically <code>h2</code> for HTTP/2).</p> <p>Usage:</p> <pre><code>haproxy.org/server-ssl: \"true\"\nhaproxy.org/server-proto: \"h2\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8443 ssl verify none proto h2\n</code></pre> <p>Dependencies: Typically used with <code>server-ssl</code></p>"},{"location":"annotations/#haproxyorgserver-crt","title":"haproxy.org/server-crt","text":"<p>Status: \u2705 Supported</p> <p>Description: Client certificate for mTLS (mutual TLS) to backend. References a Secret containing <code>tls.crt</code> and <code>tls.key</code>. Supports cross-namespace format <code>namespace/secretname</code>.</p> <p>Usage:</p> <pre><code>haproxy.org/server-ssl: \"true\"\nhaproxy.org/server-crt: \"default/client-cert\"\nhaproxy.org/server-ca: \"default/ca-cert\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8443 ssl crt /etc/haproxy/certs/client-cert.pem ca-file /etc/haproxy/certs/ca-cert.pem verify required\n</code></pre> <p>Dependencies: Requires <code>server-ssl: \"true\"</code></p> <p>Related annotations: <code>server-ca</code> (required for verification)</p>"},{"location":"annotations/#haproxyorgserver-ca","title":"haproxy.org/server-ca","text":"<p>Status: \u2705 Supported</p> <p>Description: CA certificate for verifying backend server certificates. References a Secret containing <code>tls.crt</code>. Supports cross-namespace format <code>namespace/secretname</code>.</p> <p>Usage:</p> <pre><code>haproxy.org/server-ssl: \"true\"\nhaproxy.org/server-ca: \"default/ca-cert\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8443 ssl ca-file /etc/haproxy/certs/ca-cert.pem verify required\n</code></pre> <p>Dependencies: Requires <code>server-ssl: \"true\"</code></p> <p>Related annotations: <code>server-crt</code> (for mTLS)</p>"},{"location":"annotations/#backend-health-checks-connection-management","title":"Backend Health Checks &amp; Connection Management","text":""},{"location":"annotations/#haproxyorgcheck","title":"haproxy.org/check","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable health checks for backend servers.</p> <p>Default: <code>true</code></p> <p>Usage:</p> <pre><code>haproxy.org/check: \"true\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8080 check\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>check-http</code>, <code>check-interval</code>, <code>timeout-check</code></p>"},{"location":"annotations/#haproxyorgcheck-http","title":"haproxy.org/check-http","text":"<p>Status: \u2705 Supported</p> <p>Description: HTTP URI or full HTTP request for health checks.</p> <p>Usage:</p> <pre><code># Simple URI\nhaproxy.org/check: \"true\"\nhaproxy.org/check-http: \"/health\"\n\n# Full HTTP request\nhaproxy.org/check-http: \"HEAD /health HTTP/1.1\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Simple URI\noption httpchk GET /health\n\n# Full HTTP request\noption httpchk HEAD /health HTTP/1.1\n</code></pre> <p>Dependencies: Requires <code>check: \"true\"</code></p>"},{"location":"annotations/#haproxyorgcheck-interval","title":"haproxy.org/check-interval","text":"<p>Status: \u2705 Supported</p> <p>Description: Frequency of health checks. Supports duration format (e.g., <code>10s</code>, <code>1m</code>).</p> <p>Default: <code>2s</code></p> <p>Usage:</p> <pre><code>haproxy.org/check: \"true\"\nhaproxy.org/check-interval: \"10s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8080 check inter 10s\n</code></pre> <p>Dependencies: Requires <code>check: \"true\"</code></p>"},{"location":"annotations/#haproxyorgtimeout-check","title":"haproxy.org/timeout-check","text":"<p>Status: \u2705 Supported</p> <p>Description: Timeout for health check responses. Supports duration format.</p> <p>Default: <code>5s</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-check: \"3s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout check 3s\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgpod-maxconn","title":"haproxy.org/pod-maxconn","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum total concurrent connections for all backend pods combined, automatically divided equally among HAProxy controller replicas with ceiling rounding.</p> <p>Usage:</p> <pre><code>haproxy.org/pod-maxconn: \"100\"\n</code></pre> <p>Behavior:</p> <p>The annotation value represents the total maximum connections across all HAProxy replicas. The controller automatically: - Counts running HAProxy controller pods - Divides the total by the pod count (ceiling rounding) - Applies the per-pod value to each server line</p> <p>Examples:</p> <p>Single HAProxy pod: Value applied directly without division <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    haproxy.org/pod-maxconn: \"100\"\n</code></pre></p> <p>Generated HAProxy configuration (1 HAProxy pod): <pre><code># pod-maxconn: 100 total / 1 HAProxy pods = 100 per pod\nserver SRV_1 10.0.1.5:8080 maxconn 100 check\n</code></pre></p> <p>Multiple HAProxy pods: Value divided equally with ceiling rounding <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    haproxy.org/pod-maxconn: \"100\"\n</code></pre></p> <p>Generated HAProxy configuration (2 HAProxy pods): <pre><code># pod-maxconn: 100 total / 2 HAProxy pods = 50 per pod\nserver SRV_1 10.0.1.5:8080 maxconn 50 check\n</code></pre></p> <p>Generated HAProxy configuration (3 HAProxy pods, with ceiling rounding): <pre><code># pod-maxconn: 100 total / 3 HAProxy pods = 34 per pod\nserver SRV_1 10.0.1.5:8080 maxconn 34 check\n</code></pre></p> <p>Fallback behavior: If no HAProxy pods are discovered yet (e.g., during initial startup), the full value is used temporarily until pod discovery completes.</p> <p>Dependencies: Requires HAProxy pod discovery to be operational for automatic division</p>"},{"location":"annotations/#haproxyorgscale-server-slots","title":"haproxy.org/scale-server-slots","text":"<p>Status: \u2705 Supported</p> <p>Description: Number of server slots to pre-allocate for dynamic scaling.</p> <p>Default: <code>10</code> (template default; HAProxy Ingress Controller uses <code>42</code>)</p> <p>Usage:</p> <pre><code>haproxy.org/scale-server-slots: \"100\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Pre-allocates 100 server slots for dynamic pod scaling\nserver pod1 10.0.1.5:8080\nserver pod2 10.0.1.6:8080\n# ... up to 100 slots\n</code></pre> <p>Dependencies: None</p> <p>Note: Used for runtime server addition/removal without config reload.</p>"},{"location":"annotations/#load-balancing-algorithms","title":"Load Balancing Algorithms","text":""},{"location":"annotations/#haproxyorgload-balance","title":"haproxy.org/load-balance","text":"<p>Status: \u2705 Supported</p> <p>Description: Load balancing algorithm for distributing traffic across backend servers.</p> <p>Default: <code>roundrobin</code></p> <p>Valid values: <code>roundrobin</code>, <code>leastconn</code>, <code>source</code>, <code>uri</code>, <code>hdr</code>, <code>random</code>, <code>rdp-cookie</code></p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: load-balance-example\n  annotations:\n    haproxy.org/load-balance: \"leastconn\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>backend api-backend\n    balance leastconn\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#session-persistence","title":"Session Persistence","text":""},{"location":"annotations/#haproxyorgcookie-persistence","title":"haproxy.org/cookie-persistence","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable sticky sessions using dynamic cookies. The cookie value is dynamically generated per server.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: sticky-sessions\n  annotations:\n    haproxy.org/cookie-persistence: \"SERVERID\"\nspec:\n  rules:\n    - host: app.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: app-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>backend app-backend\n    cookie SERVERID insert indirect nocache dynamic\n    dynamic-cookie-key &lt;generated-key&gt;\n    server pod1 10.0.1.5:8080 cookie pod1\n</code></pre> <p>Dependencies: None</p> <p>Note: For multi-instance setups, dynamic cookies ensure consistency across controller instances.</p>"},{"location":"annotations/#haproxyorgcookie-persistence-no-dynamic","title":"haproxy.org/cookie-persistence-no-dynamic","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable sticky sessions using static cookies (without dynamic-cookie-key). Use only in single-instance controller deployments.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: static-sticky-sessions\n  annotations:\n    haproxy.org/cookie-persistence-no-dynamic: \"SERVERID\"\nspec:\n  rules:\n    - host: app.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: app-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>backend app-backend\n    cookie SERVERID insert indirect nocache\n    server pod1 10.0.1.5:8080 cookie pod1\n</code></pre> <p>Dependencies: None</p> <p>Note: Mutually exclusive with <code>cookie-persistence</code>. For multi-instance deployments, use <code>cookie-persistence</code> (dynamic mode) instead to ensure consistent cookie values across controller instances.</p> <p>Warning: Static cookies will differ across controller instances, breaking session affinity. Only use in single-instance deployments.</p>"},{"location":"annotations/#timeouts","title":"Timeouts","text":""},{"location":"annotations/#haproxyorgtimeout-server","title":"haproxy.org/timeout-server","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum time to wait for backend server response. Supports duration format.</p> <p>Default: <code>50s</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-server: \"30s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout server 30s\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgtimeout-client","title":"haproxy.org/timeout-client","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum inactivity time on client side. Supports duration format.</p> <p>Default: <code>50s</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-client: \"60s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout client 60s\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgtimeout-connect","title":"haproxy.org/timeout-connect","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum time to wait for backend connection. Supports duration format.</p> <p>Default: <code>5s</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-connect: \"10s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout connect 10s\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgtimeout-http-request","title":"haproxy.org/timeout-http-request","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum time to wait for complete HTTP request. Supports duration format.</p> <p>Default: <code>5s</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-http-request: \"10s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout http-request 10s\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgtimeout-http-keep-alive","title":"haproxy.org/timeout-http-keep-alive","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum time to wait for a new HTTP request on a keep-alive connection. Supports duration format.</p> <p>Default: <code>1m</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-http-keep-alive: \"2m\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout http-keep-alive 2m\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgtimeout-queue","title":"haproxy.org/timeout-queue","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum time a request can wait in queue when all backend servers are busy. Supports duration format.</p> <p>Default: <code>5s</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-queue: \"30s\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout queue 30s\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#haproxyorgtimeout-tunnel","title":"haproxy.org/timeout-tunnel","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum inactivity time on tunnel connections (WebSocket, CONNECT). Supports duration format.</p> <p>Default: <code>1h</code></p> <p>Usage:</p> <pre><code>haproxy.org/timeout-tunnel: \"2h\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>timeout tunnel 2h\n</code></pre> <p>Dependencies: None</p>"},{"location":"annotations/#request-capture-logging","title":"Request Capture &amp; Logging","text":""},{"location":"annotations/#haproxyorgrequest-capture","title":"haproxy.org/request-capture","text":"<p>Status: \u2705 Supported</p> <p>Description: Capture request data for logging. Multiline format with HAProxy sample expressions.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: logging-example\n  annotations:\n    haproxy.org/request-capture: |\n      hdr(User-Agent)\n      cookie(session)\n      path\n      method\n    haproxy.org/request-capture-len: \"256\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>capture request header User-Agent len 256\ncapture request header Cookie len 256\n# path and method captured via special handling\n</code></pre> <p>Dependencies: None</p> <p>Related annotations: <code>request-capture-len</code></p>"},{"location":"annotations/#haproxyorgrequest-capture-len","title":"haproxy.org/request-capture-len","text":"<p>Status: \u2705 Supported</p> <p>Description: Maximum length for captured request data.</p> <p>Default: <code>128</code></p> <p>Usage:</p> <pre><code>haproxy.org/request-capture-len: \"256\"\n</code></pre> <p>Dependencies: Applies to <code>request-capture</code> expressions</p>"},{"location":"annotations/#source-ip-detection","title":"Source IP Detection","text":""},{"location":"annotations/#haproxyorgsrc-ip-header","title":"haproxy.org/src-ip-header","text":"<p>Status: \u2705 Supported</p> <p>Description: Extract true client IP from a specific header (useful when behind proxies/CDNs).</p> <p>Usage:</p> <pre><code># Behind Cloudflare\nhaproxy.org/src-ip-header: \"CF-Connecting-IP\"\n\n# Behind AWS ALB\nhaproxy.org/src-ip-header: \"X-Forwarded-For\"\n\n# Behind custom proxy\nhaproxy.org/src-ip-header: \"True-Client-IP\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>http-request set-src hdr(CF-Connecting-IP)\n</code></pre> <p>Dependencies: None</p> <p>Note: Use with caution - ensure the header is set by a trusted proxy.</p>"},{"location":"annotations/#advanced-backend-configuration","title":"Advanced Backend Configuration","text":""},{"location":"annotations/#haproxyorgbackend-config-snippet","title":"haproxy.org/backend-config-snippet","text":"<p>Status: \u2705 Supported</p> <p>Description: Inject raw HAProxy configuration directives into backend section. Multiline YAML string.</p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: advanced-backend\n  annotations:\n    haproxy.org/backend-config-snippet: |\n      stick-table type string len 32 size 100k expire 30m\n      stick store-response res.cook(JSESSIONID)\n      http-send-name-header X-Backend-Server\nspec:\n  rules:\n    - host: app.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: app-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>backend app-backend\n    stick-table type string len 32 size 100k expire 30m\n    stick store-response res.cook(JSESSIONID)\n    http-send-name-header X-Backend-Server\n    # ... other backend config\n</code></pre> <p>Dependencies: None</p> <p>Warning: Raw config injection bypasses validation. User is responsible for correct syntax.</p>"},{"location":"annotations/#haproxyorgsend-proxy-protocol","title":"haproxy.org/send-proxy-protocol","text":"<p>Status: \u2705 Supported</p> <p>Description: Enable PROXY protocol for backend connections to preserve client IP information.</p> <p>Valid values: <code>proxy</code>, <code>proxy-v1</code>, <code>proxy-v2</code>, <code>proxy-v2-ssl</code>, <code>proxy-v2-ssl-cn</code></p> <p>Usage:</p> <pre><code>haproxy.org/send-proxy-protocol: \"proxy-v2\"\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code>server pod1 10.0.1.5:8080 send-proxy-v2\n</code></pre> <p>Dependencies: None</p> <p>Note: Backend application must support PROXY protocol.</p>"},{"location":"annotations/#haproxyorgstandalone-backend","title":"haproxy.org/standalone-backend","text":"<p>Status: \u274c Not Implemented (Not Planned)</p> <p>Description: Create a dedicated backend for this ingress instead of sharing backends across ingresses.</p> <p>Note: This controller's architecture already generates standalone backends (one backend per ingress+service+port combination) rather than sharing backends across ingresses. Each unique combination of <code>namespace/ingress-name/service-name/port</code> gets its own dedicated backend, making this annotation redundant. Implementation is not planned.</p>"},{"location":"annotations/#authentication","title":"Authentication","text":""},{"location":"annotations/#haproxyorgauth-type","title":"haproxy.org/auth-type","text":"<p>Status: \u2705 Supported</p> <p>Description: Type of authentication to enforce. Currently only <code>basic-auth</code> is supported.</p> <p>Valid values: <code>basic-auth</code></p> <p>Usage:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: protected-api\n  annotations:\n    haproxy.org/auth-type: basic-auth\n    haproxy.org/auth-secret: auth-credentials\n    haproxy.org/auth-realm: \"API Access\"\nspec:\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 8080\n</code></pre> <p>Generated HAProxy Configuration:</p> <pre><code># Global section\nuserlist auth_default_auth-credentials\n  user admin password $2y$05$...\n\n# Backend section\nhttp-request auth realm \"API Access\" unless { http_auth(auth_default_auth-credentials) }\n</code></pre> <p>Dependencies: Requires <code>auth-secret</code> to be set</p> <p>Related annotations: <code>auth-secret</code>, <code>auth-realm</code></p> <p>Implementation notes: - Secret format: Opaque secret where key=username, value=base64-encoded password hash - Supports cross-namespace secrets: <code>namespace/secretname</code> - Automatic deduplication: multiple ingresses sharing the same secret generate a single userlist - HAProxy 3.2+ uses bcrypt password hashing (not MD5 apr1)</p>"},{"location":"annotations/#haproxyorgauth-secret","title":"haproxy.org/auth-secret","text":"<p>Status: \u2705 Supported</p> <p>Description: Reference to Kubernetes Secret containing authentication credentials. Supports cross-namespace format <code>namespace/secretname</code>.</p> <p>Usage:</p> <pre><code># Same namespace\nhaproxy.org/auth-secret: \"auth-credentials\"\n\n# Cross-namespace\nhaproxy.org/auth-secret: \"auth-system/shared-credentials\"\n</code></pre> <p>Secret format:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: auth-credentials\n  namespace: default\ntype: Opaque\ndata:\n  # Key: username\n  # Value: base64-encoded password hash (NOT htpasswd format)\n  admin: JDJ5JDA1JG1OMVdWazVRbmJnNFF3ZEFkWGJmei44YjNjZUg2UTVLT1ZDS3hSMklrTkFmSmdMaTVwSUtX\n</code></pre> <p>Generate password hash:</p> <pre><code># Create bcrypt hash and encode to base64\nhtpasswd -nbB admin mypassword | cut -d: -f2 | base64 -w0\n</code></pre> <p>Dependencies: Requires <code>auth-type: basic-auth</code></p> <p>Implementation notes: - Value must be ONLY the password hash, NOT \"username:hash\" (htpasswd format) - Multiple usernames supported: add multiple keys to the secret - HAProxy 3.2+ supports bcrypt ($2y$), not MD5 apr1 ($apr1$)</p>"},{"location":"annotations/#haproxyorgauth-realm","title":"haproxy.org/auth-realm","text":"<p>Status: \u2705 Supported</p> <p>Description: Authentication realm displayed in browser's authentication prompt.</p> <p>Default: <code>RestrictedArea</code></p> <p>Usage:</p> <pre><code>haproxy.org/auth-realm: \"API Access\"\n</code></pre> <p>Dependencies: Requires <code>auth-type: basic-auth</code> and <code>auth-secret</code></p> <p>Note: HAProxy Data Plane API requires realm without spaces (regex: <code>^[^\\s]+$</code>). Use hyphenated names.</p>"},{"location":"annotations/#known-limitations","title":"Known Limitations","text":""},{"location":"annotations/#not-implemented","title":"Not Implemented","text":"<ol> <li> <p>Service-level annotations - Annotations on Service resources are not supported. Only Ingress annotations are implemented.</p> </li> <li> <p>Deprecated annotations - Legacy annotation names (<code>whitelist</code>, <code>blacklist</code>, <code>ingress.class</code>) are not implemented. Use current names instead.</p> </li> <li> <p>RequestMirror equivalent - No annotation-based traffic mirroring. Consider using Gateway API with external SPOE agent for this feature.</p> </li> </ol>"},{"location":"annotations/#implementation-differences-from-haproxy-tech","title":"Implementation Differences from HAProxy Tech","text":"<ol> <li> <p>Template-based approach - This implementation uses Jinja2-like templates (Gonja) rather than Go code, allowing users to customize behavior through template overrides.</p> </li> <li> <p>Resource-agnostic architecture - The controller doesn't have built-in annotation handling. All annotation support is provided through pluggable template libraries.</p> </li> <li> <p>Validation tests - Each annotation implementation includes comprehensive validation tests that run during chart development/testing.</p> </li> <li> <p>Secret format for auth - Password values must be base64-encoded hashes only, not htpasswd format (<code>username:hash</code>). This simplifies template logic and aligns with Kubernetes Secret best practices.</p> </li> </ol>"},{"location":"annotations/#testing-coverage","title":"Testing Coverage","text":""},{"location":"annotations/#well-tested","title":"Well-tested","text":"<p>Authentication (3 annotations): - \u2705 <code>auth-type</code>, <code>auth-secret</code>, <code>auth-realm</code> - \u2705 Cross-namespace secret references - \u2705 Custom realm values - \u2705 Shared userlist deduplication - \u2705 Invalid auth type error handling - \u2705 Missing secret error handling</p>"},{"location":"annotations/#other-annotations","title":"Other Annotations","text":"<p>The remaining 51 annotations have varying levels of test coverage: - 47 fully supported annotations include validation tests in the template library - 0 partially implemented annotations - all features are either fully supported or not implemented - 3 not implemented annotations (including 2 deprecated) have no test coverage</p>"},{"location":"annotations/#implementation-status-summary","title":"Implementation Status Summary","text":"<p>Total annotations: 54</p> <ul> <li>\u2705 Fully Supported: 51 (94.4%)</li> <li>Access Control &amp; IP Filtering: 2 annotations (allowlist, denylist)</li> <li>Authentication: 3 annotations (auth-type, auth-secret, auth-realm)</li> <li>CORS: 6 annotations (enable, allow-origin, allow-methods, allow-headers, allow-credentials, max-age)</li> <li>Rate Limiting: 4 annotations (requests, period, size, status-code)</li> <li>Header Manipulation: 3 annotations (forwarded-for, request-set-header, response-set-header)</li> <li>Path Manipulation: 1 annotation (path-rewrite)</li> <li>Request Redirect: 2 annotations (request-redirect, request-redirect-code)</li> <li>SSL/TLS: 4 annotations (ssl-redirect, ssl-redirect-code, ssl-redirect-port, ssl-passthrough)</li> <li>Health Checks: 3 annotations (check, check-http, check-interval)</li> <li>Load Balancing: 1 annotation (load-balance)</li> <li>Session Persistence: 2 annotations (cookie-persistence, cookie-persistence-no-dynamic)</li> <li>Timeouts: 8 annotations (server, client, connect, http-request, http-keep-alive, queue, tunnel, check)</li> <li>Logging: 3 annotations (src-ip-header, request-capture, request-capture-len)</li> <li>Host Manipulation: 1 annotation (set-host)</li> <li>Connection Management: 1 annotation (pod-maxconn)</li> <li>Server Scaling: 1 annotation (scale-server-slots)</li> <li>Backend Server Options: 4 annotations (server-ssl, server-proto, server-crt, server-ca)</li> <li>Proxy Protocol: 1 annotation (send-proxy-protocol)</li> <li> <p>Advanced Backend Config: 1 annotation (backend-config-snippet)</p> </li> <li> <p>\u26a0\ufe0f Partially Implemented: 0 (0%)</p> </li> <li> <p>\u274c Not Implemented: 3 (5.6%)</p> </li> <li>1 annotation: standalone-backend (not planned - architecture already provides this functionality)</li> <li>2 deprecated annotations: whitelist, blacklist (replaced by allowlist/denylist)</li> </ul>"},{"location":"annotations/#see-also","title":"See Also","text":"<ul> <li>HAProxy Ingress Controller Documentation</li> <li>HAProxy Ingress Controller Source Code</li> <li>Gateway API Support - For Gateway API resources (HTTPRoute, GRPCRoute)</li> <li>Template Library Architecture</li> </ul>"},{"location":"gateway-api/","title":"Gateway API Support","text":"<p>The HAProxy Template Ingress Controller chart provides Gateway API support through the <code>gateway.yaml</code> template library. This document describes which features of Gateway API v1.2.0 HTTPRoute and GRPCRoute are currently supported.</p>"},{"location":"gateway-api/#overview","title":"Overview","text":"<p>Gateway API support is implemented as a template library that plugs into the controller's resource-agnostic architecture. The controller itself doesn't know about Gateway API - resource support is added by the chart through template libraries.</p> <p>Enable Gateway API support:</p> <pre><code># values.yaml\ncontroller:\n  templateLibraries:\n    gateway:\n      enabled: true\n</code></pre> <p>The Gateway API CRDs must be installed separately in your cluster. The chart automatically detects their presence and enables the gateway library if available.</p>"},{"location":"gateway-api/#architecture","title":"Architecture","text":"<p>The <code>gateway.yaml</code> library: - Declares <code>httproutes</code> and <code>grpcroutes</code> as watched resources - Implements backend generation for Gateway routes - Adds routing rules to HAProxy map files - Plugs into extension points defined in <code>base.yaml</code></p> <p>This architecture allows the controller to remain resource-agnostic while the chart provides specific resource support.</p>"},{"location":"gateway-api/#httproute-support","title":"HTTPRoute Support","text":""},{"location":"gateway-api/#specparentrefs","title":"spec.parentRefs","text":"Field Status Notes <code>parentRefs[].name</code> \u2705 Supported Gateway reference <code>parentRefs[].namespace</code> \u26a0\ufe0f Partial Field exists but cross-namespace not tested <code>parentRefs[].sectionName</code> \u274c Not Implemented Listener-specific attachment not supported <code>parentRefs[].port</code> \u274c Not Implemented Port override not supported"},{"location":"gateway-api/#spechostnames","title":"spec.hostnames","text":"Field Status Notes <code>hostnames[]</code> \u2705 Supported Multiple hostnames per route Wildcard hostnames (e.g., <code>*.example.com</code>) \u26a0\ufe0f Untested May work but not validated Empty hostnames list \u2705 Supported Matches all hosts <p>Example:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: example\nspec:\n  hostnames:\n    - \"example.com\"\n    - \"www.example.com\"\n  rules:\n    - backendRefs:\n        - name: example-svc\n          port: 80\n</code></pre>"},{"location":"gateway-api/#specrulesmatches-path-matching","title":"spec.rules[].matches - Path Matching","text":"Field Status Notes <code>matches[].path.type: Exact</code> \u2705 Supported Exact path match using HAProxy map <code>matches[].path.type: PathPrefix</code> \u2705 Supported Prefix match using HAProxy map_beg <code>matches[].path.type: RegularExpression</code> \u2705 Supported Regex match using HAProxy map_reg <code>matches[].path.value</code> \u2705 Supported Path value used in matching Empty matches list \u2705 Supported Defaults to PathPrefix <code>/</code> <p>Path Match Priority: Exact &gt; Regex &gt; Prefix-exact &gt; Prefix (configurable via libraries)</p> <p>Example - Path matching:</p> <pre><code>spec:\n  rules:\n    # Exact path match\n    - matches:\n        - path:\n            type: Exact\n            value: /api/v1/users\n      backendRefs:\n        - name: users-api-svc\n          port: 8080\n\n    # Prefix match\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n      backendRefs:\n        - name: api-svc\n          port: 8080\n\n    # Regex match\n    - matches:\n        - path:\n            type: RegularExpression\n            value: ^/api/v[0-9]+/.*\n      backendRefs:\n        - name: versioned-api-svc\n          port: 8080\n</code></pre>"},{"location":"gateway-api/#specrulesmatches-method-header-and-query-matching","title":"spec.rules[].matches - Method, Header and Query Matching","text":"Field Status Notes <code>matches[].method</code> \u2705 Supported HTTP method matching (GET, POST, etc.) <code>matches[].headers[]</code> \u2705 Supported Header-based routing with exact and regex matching <code>matches[].headers[].type: Exact</code> \u2705 Supported Exact header value matching <code>matches[].headers[].type: RegularExpression</code> \u2705 Supported Regex header value matching <code>matches[].headers[].name</code> \u2705 Supported Case-insensitive header name <code>matches[].headers[].value</code> \u2705 Supported Header value to match <code>matches[].queryParams[]</code> \u2705 Supported Query parameter matching <code>matches[].queryParams[].type: Exact</code> \u2705 Supported Exact query parameter value matching <code>matches[].queryParams[].type: RegularExpression</code> \u2705 Supported Regex query parameter matching <code>matches[].queryParams[].name</code> \u2705 Supported Query parameter name <code>matches[].queryParams[].value</code> \u2705 Supported Query parameter value to match <p>Match Precedence (Gateway API v1 spec):</p> <p>When multiple routes match the same request, ties are broken in the following order: 1. Path specificity - Exact &gt; RegularExpression &gt; PathPrefix (by length) 2. Method matchers - Routes with method matchers have higher priority 3. Header matchers - More header matchers = higher priority 4. Query parameter matchers - More query matchers = higher priority 5. Creation timestamp - Older routes have priority 6. Alphabetical order - By namespace/name as final tie-breaker</p> <p>Example - Method matching:</p> <pre><code>spec:\n  rules:\n    # Match only GET requests\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n          method: GET\n      backendRefs:\n        - name: api-read-svc\n          port: 8080\n\n    # Match only POST requests\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n          method: POST\n      backendRefs:\n        - name: api-write-svc\n          port: 8080\n</code></pre> <p>Example - Header matching:</p> <pre><code>spec:\n  rules:\n    # Exact header match\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n          headers:\n            - name: X-API-Version\n              type: Exact\n              value: \"v2\"\n      backendRefs:\n        - name: api-v2-svc\n          port: 8080\n\n    # Regex header match\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n          headers:\n            - name: User-Agent\n              type: RegularExpression\n              value: \".*Mobile.*\"\n      backendRefs:\n        - name: mobile-api-svc\n          port: 8080\n</code></pre> <p>Example - Query parameter matching:</p> <pre><code>spec:\n  rules:\n    # Exact query parameter match\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /search\n          queryParams:\n            - name: category\n              type: Exact\n              value: electronics\n      backendRefs:\n        - name: electronics-search-svc\n          port: 8080\n\n    # Regex query parameter match\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n          queryParams:\n            - name: version\n              type: RegularExpression\n              value: \"^v[2-3]$\"\n      backendRefs:\n        - name: modern-api-svc\n          port: 8080\n</code></pre> <p>Example - Complex matching with precedence:</p> <pre><code>spec:\n  rules:\n    # Higher priority: method + headers + query\n    - matches:\n        - path:\n            type: Exact\n            value: /api/users\n          method: POST\n          headers:\n            - name: Content-Type\n              type: Exact\n              value: application/json\n          queryParams:\n            - name: action\n              type: Exact\n              value: create\n      backendRefs:\n        - name: user-create-svc\n          port: 8080\n\n    # Lower priority: only path matching\n    - matches:\n        - path:\n            type: Exact\n            value: /api/users\n      backendRefs:\n        - name: user-generic-svc\n          port: 8080\n</code></pre>"},{"location":"gateway-api/#specrulesfilters","title":"spec.rules[].filters","text":"Filter Type Conformance Status Notes <code>RequestHeaderModifier</code> Core \u2705 Supported Add/Set/Remove request headers <code>ResponseHeaderModifier</code> Extended \u2705 Supported Add/Set/Remove response headers <code>RequestRedirect</code> Core \u2705 Supported HTTP redirects with scheme/hostname/port/path/statusCode <code>URLRewrite</code> Extended \u2705 Supported Path and hostname rewriting <code>RequestMirror</code> Extended \u274c Not Implemented Requires external SPOE agent (see Criteo traffic-mirroring) <code>ExtensionRef</code> Implementation-specific \u274c Not Implemented Planned as Gateway API equivalent of Ingress annotations"},{"location":"gateway-api/#requestheadermodifier-filter","title":"RequestHeaderModifier Filter","text":"<p>The <code>RequestHeaderModifier</code> filter modifies HTTP request headers before forwarding to backends. Supports set (replace), add (append), and remove operations.</p> <p>Supported Operations:</p> <ul> <li><code>set</code> - Sets a header value, replacing any existing values</li> <li><code>add</code> - Adds a header value, appending to existing values</li> <li><code>remove</code> - Removes all values for a header</li> </ul> <p>Example - Set and add headers:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n      filters:\n        - type: RequestHeaderModifier\n          requestHeaderModifier:\n            set:\n              - name: X-API-Version\n                value: \"v2\"\n            add:\n              - name: X-Request-ID\n                value: \"%[rand]\"\n            remove:\n              - Authorization\n      backendRefs:\n        - name: api-svc\n          port: 8080\n</code></pre> <p>HAProxy Implementation:</p> <p>Generates <code>http-request</code> directives with conditions based on route matching:</p> <pre><code># Set header (replaces existing)\nhttp-request set-header X-API-Version \"v2\" if &lt;route-conditions&gt;\n\n# Add header (appends to existing)\nhttp-request add-header X-Request-ID \"%[rand]\" if &lt;route-conditions&gt;\n\n# Remove header\nhttp-request del-header Authorization if &lt;route-conditions&gt;\n</code></pre>"},{"location":"gateway-api/#responseheadermodifier-filter","title":"ResponseHeaderModifier Filter","text":"<p>The <code>ResponseHeaderModifier</code> filter modifies HTTP response headers before returning to clients. Supports the same set/add/remove operations as RequestHeaderModifier.</p> <p>Example - Add security headers:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /\n      filters:\n        - type: ResponseHeaderModifier\n          responseHeaderModifier:\n            set:\n              - name: Strict-Transport-Security\n                value: \"max-age=31536000; includeSubDomains\"\n              - name: X-Frame-Options\n                value: \"DENY\"\n            add:\n              - name: X-Custom-Header\n                value: \"custom-value\"\n            remove:\n              - Server\n              - X-Powered-By\n      backendRefs:\n        - name: web-svc\n          port: 80\n</code></pre> <p>HAProxy Implementation:</p> <p>Generates <code>http-response</code> directives:</p> <pre><code># Set response header (replaces existing)\nhttp-response set-header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" if &lt;route-conditions&gt;\n\n# Add response header (appends to existing)\nhttp-response add-header X-Custom-Header \"custom-value\" if &lt;route-conditions&gt;\n\n# Remove response header\nhttp-response del-header Server if &lt;route-conditions&gt;\n</code></pre>"},{"location":"gateway-api/#requestredirect-filter","title":"RequestRedirect Filter","text":"<p>The <code>RequestRedirect</code> filter implements HTTP redirects with support for scheme, hostname, port, path, and status code modifications. Only available for HTTPRoute (not applicable to gRPC).</p> <p>Supported Fields:</p> <ul> <li><code>scheme</code> - Change protocol (http/https)</li> <li><code>hostname</code> - Change destination hostname</li> <li><code>port</code> - Change destination port</li> <li><code>path.type</code> - ReplaceFullPath or ReplacePrefixMatch</li> <li><code>path.replaceFullPath</code> - New absolute path</li> <li><code>path.replacePrefixMatch</code> - New path prefix</li> <li><code>statusCode</code> - HTTP status code (default: 302)</li> </ul> <p>Example - HTTPS redirect:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /\n      filters:\n        - type: RequestRedirect\n          requestRedirect:\n            scheme: https\n            statusCode: 301\n</code></pre> <p>Example - Path rewrite with redirect:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /old-api\n      filters:\n        - type: RequestRedirect\n          requestRedirect:\n            path:\n              type: ReplacePrefixMatch\n              replacePrefixMatch: /api/v2\n            statusCode: 308\n</code></pre> <p>HAProxy Implementation:</p> <p>Generates <code>http-request redirect</code> directives:</p> <pre><code># HTTPS redirect\nhttp-request redirect scheme https code 301 if &lt;route-conditions&gt;\n\n# Path prefix replacement\nhttp-request redirect prefix \"/api/v2\" code 308 if &lt;route-conditions&gt;\n\n# Full path replacement\nhttp-request redirect location \"https://example.com/new/path\" code 302 if &lt;route-conditions&gt;\n</code></pre>"},{"location":"gateway-api/#urlrewrite-filter","title":"URLRewrite Filter","text":"<p>The <code>URLRewrite</code> filter rewrites request URLs before forwarding to backends, supporting both hostname and path modifications. Only available for HTTPRoute (not applicable to gRPC).</p> <p>Supported Fields:</p> <ul> <li><code>hostname</code> - Rewrite the Host header</li> <li><code>path.type</code> - ReplaceFullPath or ReplacePrefixMatch</li> <li><code>path.replaceFullPath</code> - New absolute path</li> <li><code>path.replacePrefixMatch</code> - New path prefix</li> </ul> <p>Example - Strip path prefix:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api/v1\n      filters:\n        - type: URLRewrite\n          urlRewrite:\n            path:\n              type: ReplacePrefixMatch\n              replacePrefixMatch: /\n      backendRefs:\n        - name: api-svc\n          port: 8080\n</code></pre> <p>Example - Hostname and path rewrite:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /external\n      filters:\n        - type: URLRewrite\n          urlRewrite:\n            hostname: internal-api.example.svc.cluster.local\n            path:\n              type: ReplacePrefixMatch\n              replacePrefixMatch: /api\n      backendRefs:\n        - name: internal-api-svc\n          port: 8080\n</code></pre> <p>HAProxy Implementation:</p> <p>Generates <code>http-request</code> directives for header and path manipulation:</p> <pre><code># Hostname rewrite\nhttp-request set-header Host \"internal-api.example.svc.cluster.local\" if &lt;route-conditions&gt;\n\n# Full path replacement\nhttp-request set-path \"/new/path\" if &lt;route-conditions&gt;\n\n# Prefix replacement (using regex)\nhttp-request replace-path \"^/api/v1(.*)\" \"/\\1\" if &lt;route-conditions&gt;\n</code></pre> <p>Difference from RequestRedirect:</p> <ul> <li>URLRewrite rewrites the request and forwards to backend (transparent to client)</li> <li>RequestRedirect sends HTTP redirect response to client (client sees new URL)</li> </ul>"},{"location":"gateway-api/#specrulesbackendrefs","title":"spec.rules[].backendRefs","text":"Field Status Notes <code>backendRefs[].name</code> \u2705 Supported Service name <code>backendRefs[].namespace</code> \u26a0\ufe0f Partial Not explicitly handled, likely defaults to route namespace <code>backendRefs[].port</code> \u2705 Supported Service port number <code>backendRefs[].weight</code> \u2705 Supported Traffic splitting with weighted distribution <code>backendRefs[].filters[]</code> \u274c Not Implemented Per-backend filters not supported Multiple backends \u2705 Supported Weighted traffic splitting using MULTIBACKEND qualifier Single backend \u2705 Supported Optimized with BACKEND qualifier (avoids weighted logic) Omitted weight \u2705 Supported Defaults to weight 1 <p>Weighted Backend Implementation:</p> <p>The gateway library uses HAProxy's <code>rand()</code> function and map-based selection for O(1) weighted routing: - Weights are pre-expanded into map entries (e.g., 70/30 split = 100 map entries) - Entry 0-69 map to backend 1, entries 70-99 map to backend 2 - HAProxy generates random number % total_weight and looks up backend in map</p> <p>Example - Weighted traffic splitting:</p> <pre><code>spec:\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /app\n      backendRefs:\n        # 70% of traffic\n        - name: app-v1\n          port: 80\n          weight: 70\n        # 30% of traffic\n        - name: app-v2\n          port: 80\n          weight: 30\n</code></pre> <p>Example - Default weights:</p> <pre><code>spec:\n  rules:\n    - backendRefs:\n        # Omitted weight defaults to 1 (50/50 split)\n        - name: backend-a\n          port: 80\n        - name: backend-b\n          port: 80\n</code></pre>"},{"location":"gateway-api/#advanced-features","title":"Advanced Features","text":"<p>Backend Deduplication:</p> <p>The template automatically deduplicates backends when multiple routes reference the same service+port combination, preventing duplicate HAProxy backend definitions.</p> <p>Route Key Generation:</p> <p>Internal route identifiers use the format <code>namespace_routename_ruleindex</code> to ensure uniqueness across namespaces and rules.</p>"},{"location":"gateway-api/#grpcroute-support","title":"GRPCRoute Support","text":""},{"location":"gateway-api/#specparentrefs_1","title":"spec.parentRefs","text":"Field Status Notes All fields \u26a0\ufe0f Similar to HTTPRoute Same template pattern and limitations"},{"location":"gateway-api/#spechostnames_1","title":"spec.hostnames","text":"Field Status Notes <code>hostnames[]</code> \u2705 Supported Multiple hostnames per route"},{"location":"gateway-api/#specrulesmatches","title":"spec.rules[].matches","text":"Field Status Notes <code>matches[].method.type: Exact</code> \u2705 Supported Exact match for gRPC service/method <code>matches[].method.type: RegularExpression</code> \u2705 Supported Regex match for gRPC service/method <code>matches[].method.service</code> \u2705 Supported gRPC service name (e.g., <code>com.example.User</code>) <code>matches[].method.method</code> \u2705 Supported gRPC method name (e.g., <code>GetUser</code>) <code>matches[].headers[]</code> \u2705 Supported Header matching (same as HTTPRoute) <p>gRPC Method Routing:</p> <p>The gateway library now supports routing based on gRPC service and method names. The gRPC path format <code>/package.Service/Method</code> is used for matching.</p> <p>Example - gRPC method routing:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GRPCRoute\nmetadata:\n  name: grpc-users\nspec:\n  hostnames:\n    - \"api.example.com\"\n  rules:\n    # Route GetUser calls to read-only service\n    - matches:\n        - method:\n            type: Exact\n            service: com.example.UserService\n            method: GetUser\n      backendRefs:\n        - name: user-read-svc\n          port: 9090\n\n    # Route CreateUser calls to write service\n    - matches:\n        - method:\n            type: Exact\n            service: com.example.UserService\n            method: CreateUser\n      backendRefs:\n        - name: user-write-svc\n          port: 9090\n\n    # Route all other UserService calls with regex\n    - matches:\n        - method:\n            type: RegularExpression\n            service: com\\.example\\.UserService\n            # Matches any method\n      backendRefs:\n        - name: user-general-svc\n          port: 9090\n</code></pre>"},{"location":"gateway-api/#specrulesfilters_1","title":"spec.rules[].filters","text":"Filter Type Conformance Status Notes <code>RequestHeaderModifier</code> Core \u2705 Supported Same implementation as HTTPRoute <code>ResponseHeaderModifier</code> Extended \u2705 Supported Same implementation as HTTPRoute <code>RequestRedirect</code> Core N/A HTTPRoute only - not applicable to gRPC <code>URLRewrite</code> Extended N/A HTTPRoute only - not applicable to gRPC <code>RequestMirror</code> Extended \u274c Not Implemented Requires external SPOE agent (see Criteo traffic-mirroring) <code>ExtensionRef</code> Implementation-specific \u274c Not Implemented Planned as Gateway API equivalent of Ingress annotations"},{"location":"gateway-api/#specrulesbackendrefs_1","title":"spec.rules[].backendRefs","text":"Field Status Notes All <code>backendRefs</code> fields \u2705 Supported Same implementation as HTTPRoute HTTP/2 protocol \u2705 Supported Backends generated with <code>proto h2</code> flag <p>Example - GRPCRoute:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GRPCRoute\nmetadata:\n  name: grpc-example\nspec:\n  hostnames:\n    - \"grpc.example.com\"\n  rules:\n    - backendRefs:\n        - name: grpc-svc\n          port: 9090\n</code></pre>"},{"location":"gateway-api/#debug-headers","title":"Debug Headers","text":"<p>When debug headers are enabled, the gateway library adds response headers to help troubleshoot routing decisions:</p> <pre><code># values.yaml\ncontroller:\n  config:\n    debug:\n      headers:\n        enabled: true\n</code></pre> <p>Response Headers: - <code>X-Gateway-Matched-Route</code> - The namespace/name of the matched HTTPRoute or GRPCRoute - <code>X-Gateway-Match-Reason</code> - Additional information about why the route was selected (e.g., \"method match\", \"header match\")</p> <p>These headers are useful for: - Verifying which route handled a request - Understanding precedence when multiple routes match - Debugging complex routing configurations</p>"},{"location":"gateway-api/#known-limitations","title":"Known Limitations","text":""},{"location":"gateway-api/#not-implemented","title":"Not Implemented","text":"<ol> <li> <p>RequestMirror filter - Requires external SPOE (Stream Processing Offload Engine) agent running alongside HAProxy. Cannot be implemented with configuration templates alone. Consider using Criteo traffic-mirroring for modular traffic mirroring with HAProxy SPOE support.</p> </li> <li> <p>ExtensionRef filter - Custom filter extension mechanism not yet implemented. This is planned as the Gateway API equivalent of Ingress annotations, enabling custom functionality beyond standard filters.</p> </li> <li> <p>Per-backend filters (<code>backendRefs[].filters[]</code>) - Filters currently apply at the rule level only, not per-backend. This Gateway API feature allows different filter behavior for different backends within the same rule.</p> </li> </ol>"},{"location":"gateway-api/#untested-features","title":"Untested Features","text":"<ul> <li>Cross-namespace backend references</li> <li>Cross-namespace parent Gateway references</li> <li>Wildcard hostname patterns</li> <li>Listener-specific route attachment (<code>sectionName</code>)</li> </ul>"},{"location":"gateway-api/#testing-coverage","title":"Testing Coverage","text":"<p>The gateway library includes comprehensive validation tests:</p> <p>Well-tested: - HTTPRoute path matching (Exact, PathPrefix, RegularExpression) - HTTPRoute method matching (GET, POST, etc.) - HTTPRoute header matching (Exact and RegularExpression types) - HTTPRoute query parameter matching (Exact and RegularExpression types) - HTTPRoute weighted backends (various weight combinations, defaults) - HTTPRoute default behaviors (no matches \u2192 PathPrefix /) - HTTPRoute match precedence and tie-breaking rules - HTTPRoute filters (RequestHeaderModifier, ResponseHeaderModifier, RequestRedirect, URLRewrite) - Backend deduplication (multiple routes to same service+port) - GRPCRoute backend generation with HTTP/2 - GRPCRoute method-based routing (service and method matching) - GRPCRoute filters (RequestHeaderModifier, ResponseHeaderModifier) - Complex route conflict resolution with VAR qualifiers</p> <p>Untested: - Cross-namespace references - Wildcard hostnames - Per-backend filters (<code>backendRefs[].filters[]</code>) - RequestMirror filter (requires external SPOE agent) - ExtensionRef filter (not yet implemented)</p>"},{"location":"gateway-api/#future-development","title":"Future Development","text":"<p>Priority areas for future enhancement:</p> <ol> <li> <p>ExtensionRef support - Implement custom filter extension mechanism as the Gateway API equivalent of Ingress annotations. This will enable custom functionality beyond standard filters.</p> </li> <li> <p>Per-backend filters - Support <code>backendRefs[].filters[]</code> to allow different filter behavior for different backends within the same rule.</p> </li> <li> <p>Request mirroring - Investigate integration with external SPOE agents (e.g., Criteo traffic-mirroring) for traffic shadowing capabilities.</p> </li> <li> <p>Cross-namespace testing - Validate cross-namespace backend and Gateway references work correctly.</p> </li> <li> <p>Wildcard hostname support - Test and document wildcard hostname patterns (e.g., <code>*.example.com</code>).</p> </li> </ol>"},{"location":"gateway-api/#see-also","title":"See Also","text":"<ul> <li>Gateway API Documentation</li> <li>HAProxy Configuration Reference</li> <li>Template Library Architecture</li> </ul>"}]}